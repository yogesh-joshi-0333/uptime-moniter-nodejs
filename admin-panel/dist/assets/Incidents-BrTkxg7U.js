import{o as e,r as t,f as s,k as a,p as r,M as l,R as d,c as i,q as n,F as c,l as o,z as g,j as u,C as x,D as m,g as v,B as p,y}from"./vendor-CszhsB1H.js";import{u as h}from"./logs-DBJRUo48.js";import{c as f}from"./index-BWaFKzkF.js";import{_ as k}from"./LoadingSpinner-BAJStyFw.js";import{_ as w}from"./EmptyState-Dau_j8o7.js";const b={class:"space-y-6"},T={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},_={key:0,class:"card border-danger-500 dark:border-danger-400"},D={class:"card-header bg-danger-50 dark:bg-danger-900/30"},j={class:"flex items-center gap-2"},I={class:"text-lg font-semibold text-danger-700 dark:text-danger-400"},L={class:"divide-y divide-gray-200 dark:divide-gray-700"},$={class:"flex items-start justify-between gap-4"},M={class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},S={class:"text-sm text-danger-600 dark:text-danger-400 mt-2"},A={class:"text-right"},O={class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},R={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},z={key:1,class:"card p-12"},B={key:2,class:"card p-8 text-center"},C={key:3,class:"card"},N={class:"card-header"},P={class:"text-lg font-semibold text-gray-900 dark:text-white"},U={key:1,class:"divide-y divide-gray-200 dark:divide-gray-700"},W={class:"flex items-start justify-between gap-4"},q={class:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mt-1"},E={class:"text-sm text-gray-600 dark:text-gray-400 mt-2"},F={class:"text-right"},V={class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},G={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},H={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},J={class:"card p-4 text-center"},K={class:"text-3xl font-bold text-gray-900 dark:text-white"},Q={class:"card p-4 text-center"},X={class:"text-3xl font-bold text-danger-600"},Y={class:"card p-4 text-center"},Z={class:"text-3xl font-bold text-success-600"},ee={__name:"Incidents",setup(ee){const te=h(),se=f(),ae=t(!0),re=t("24h"),le=i(()=>{const e=te.logs.filter(e=>"down"===e.status),t=[];let s=null;for(const a of e)!s||s.websiteId!==a.website_id||new Date(s.endTime)-new Date(a.checked_at)>3e5?(s&&t.push(s),s={id:a.id,websiteId:a.website_id,url:a.url||ne(a.website_id),startTime:a.checked_at,endTime:a.checked_at,errors:[a.error_reason],count:1}):(s.endTime=a.checked_at,s.errors.push(a.error_reason),s.count++);return s&&t.push(s),t}),de=i(()=>le.value.filter(e=>Date.now()-new Date(e.endTime).getTime()<3e5)),ie=i(()=>le.value.filter(e=>Date.now()-new Date(e.endTime).getTime()>=3e5));function ne(e){const t=se.websites.find(t=>t.id===e);return(null==t?void 0:t.url)||`Website #${e}`}function ce(e){return e?new Date(e).toLocaleString():"-"}function oe(e,t){const s=new Date(t)-new Date(e),a=Math.floor(s/6e4),r=Math.floor(s%6e4/1e3);if(a>60){return`${Math.floor(a/60)}h ${a%60}m`}return a>0?`${a}m ${r}s`:`${r}s`}function ge(e){var t;const s={};for(const a of e)a&&(s[a]=(s[a]||0)+1);return(null==(t=Object.entries(s).sort((e,t)=>t[1]-e[1])[0])?void 0:t[0])||"Unknown error"}return e(async()=>{ae.value=!0,await Promise.all([se.fetchWebsites(),te.fetchLogs({status:"down"})]),ae.value=!1}),(e,t)=>{const i=m("router-link");return v(),s("div",b,[a("div",T,[t[2]||(t[2]=a("div",null,[a("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Incidents"),a("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Track and manage downtime incidents ")],-1)),l(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>re.value=e),class:"select w-48"},[...t[1]||(t[1]=[a("option",{value:"1h"},"Last hour",-1),a("option",{value:"24h"},"Last 24 hours",-1),a("option",{value:"7d"},"Last 7 days",-1),a("option",{value:"30d"},"Last 30 days",-1)])],512),[[d,re.value]])]),de.value.length?(v(),s("div",_,[a("div",D,[a("div",j,[t[3]||(t[3]=a("span",{class:"w-3 h-3 rounded-full bg-danger-500 animate-pulse"},null,-1)),a("h3",I," Active Incidents ("+n(de.value.length)+") ",1)])]),a("div",L,[(v(!0),s(c,null,o(de.value,e=>(v(),s("div",{key:e.id,class:"p-4"},[a("div",$,[a("div",null,[g(i,{to:`/websites/${e.websiteId}`,class:"text-lg font-medium text-gray-900 dark:text-white hover:text-primary-600"},{default:p(()=>[y(n(e.url),1)]),_:2},1032,["to"]),a("p",M," Started "+n(ce(e.startTime)),1),a("p",S,n(ge(e.errors)),1)]),a("div",A,[t[4]||(t[4]=a("span",{class:"badge badge-danger"},"Ongoing",-1)),a("p",O," Duration: "+n(oe(e.startTime,new Date)),1),a("p",R,n(e.count)+" failed checks ",1)])])]))),128))])])):r("",!0),ae.value?(v(),s("div",z,[g(k,{size:"lg"})])):le.value.length?(v(),s("div",C,[a("div",N,[a("h3",P," Past Incidents ("+n(ie.value.length)+") ",1)]),ie.value.length?(v(),s("div",U,[(v(!0),s(c,null,o(ie.value,e=>(v(),s("div",{key:e.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[a("div",W,[a("div",null,[g(i,{to:`/websites/${e.websiteId}`,class:"font-medium text-gray-900 dark:text-white hover:text-primary-600"},{default:p(()=>[y(n(e.url),1)]),_:2},1032,["to"]),a("div",q,[a("span",null,n(ce(e.startTime)),1),t[6]||(t[6]=a("span",null,"â†’",-1)),a("span",null,n(ce(e.endTime)),1)]),a("p",E,n(ge(e.errors)),1)]),a("div",F,[t[7]||(t[7]=a("span",{class:"badge badge-success"},"Resolved",-1)),a("p",V," Duration: "+n(oe(e.startTime,e.endTime)),1),a("p",G,n(e.count)+" failed checks ",1)])])]))),128))])):(v(),x(w,{key:0,title:"No past incidents",description:"All incidents are currently active or no incidents occurred in this period.",icon:"empty"}))])):(v(),s("div",B,[...t[5]||(t[5]=[u('<div class="w-16 h-16 mx-auto mb-4 rounded-full bg-success-50 dark:bg-success-500/20 flex items-center justify-center"><svg class="w-8 h-8 text-success-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div><h3 class="text-lg font-semibold text-gray-900 dark:text-white">All Systems Operational</h3><p class="text-gray-500 dark:text-gray-400 mt-1">No incidents in the selected time period.</p>',3)])])),a("div",H,[a("div",J,[a("p",K,n(le.value.length),1),t[8]||(t[8]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Incidents",-1))]),a("div",Q,[a("p",X,n(de.value.length),1),t[9]||(t[9]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Active",-1))]),a("div",Y,[a("p",Z,n(ie.value.length),1),t[10]||(t[10]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Resolved",-1))])])])}}};export{ee as default};
