import{r as e,u as a,o as t,a as l,w as s,f as r,k as o,p as n,C as u,m as i,y as d,q as c,M as v,R as p,F as g,l as m,x as b,N as y,c as x,z as k,D as w,g as f,B as h}from"./vendor-CszhsB1H.js";import{c as C,s as j,d as _}from"./index-BWaFKzkF.js";import{_ as S}from"./LoadingSpinner-BAJStyFw.js";import{_ as I}from"./EmptyState-Dau_j8o7.js";const L={class:"space-y-6"},U={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},R={class:"flex items-center gap-2"},M={class:"card p-4"},$={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"},T=["value"],V={key:0,class:"flex items-center gap-2 text-sm text-success-600 dark:text-success-400"},B={key:1,class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},N={class:"flex items-center gap-3"},P=["value"],W={class:"text-sm text-gray-600 dark:text-gray-400"},E={key:2,class:"card p-12"},D={key:4,class:"card overflow-hidden"},F={class:"overflow-x-auto"},O={class:"table"},q={class:"divide-y divide-gray-200 dark:divide-gray-700"},z={class:"font-mono text-sm"},A={class:"text-gray-700 dark:text-gray-300"},G=["title"],H={key:0,class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700"},J={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},K={class:"flex sm:hidden items-center gap-2 w-full justify-between"},Q=["disabled"],X={class:"text-sm text-gray-600 dark:text-gray-400"},Y=["disabled"],Z={class:"hidden sm:flex items-center gap-1"},ee=["disabled"],ae=["disabled"],te={key:0,class:"px-3 py-2 text-gray-400"},le=["onClick"],se=["disabled"],re=["disabled"],oe={class:"hidden lg:flex items-center gap-2"},ne=["max","value"],ue={__name:"Logs",setup(ue){const ie=a(),de=C(),ce=e(!0),ve=e([]),pe=e(0),ge=e(1),me=e(50),be=x(()=>Math.ceil(pe.value/me.value)),ye=e({websiteId:ie.query.websiteId||"",status:"",from:"",to:""}),xe=e(!1),ke=e([]),we=[10,25,50,100,200,300,500];async function fe(){ce.value=!0;try{const e=new URLSearchParams;e.append("page",ge.value),e.append("limit",me.value),ye.value.websiteId&&e.append("websiteId",ye.value.websiteId),ye.value.status&&e.append("status",ye.value.status),ye.value.from&&e.append("from",ye.value.from),ye.value.to&&e.append("to",ye.value.to);const a=await _.get(`/logs?${e.toString()}`);ve.value=a.data;const t=new URLSearchParams;ye.value.websiteId&&t.append("websiteId",ye.value.websiteId),ye.value.status&&t.append("status",ye.value.status),ye.value.from&&t.append("from",ye.value.from),ye.value.to&&t.append("to",ye.value.to);const l=await _.get(`/logs/count?${t.toString()}`);pe.value=l.data.count||ve.value.length}catch(e){pe.value=ve.value.length}finally{ce.value=!1}}let he=null;function Ce(){xe.value=!xe.value,xe.value?ke.value=[]:fe()}function je(){ye.value={websiteId:"",status:"",from:"",to:""},ge.value=1,xe.value=!1,ke.value=[]}function _e(e){e>=1&&e<=be.value&&(ge.value=e)}function Se(e){const a=de.websites.find(a=>a.id===e);return(null==a?void 0:a.url)||`Website #${e}`}function Ie(){const e=xe.value?ke.value:ve.value,a=[["Timestamp","Website","Status","Response Time (ms)","Error"].join(","),...e.map(e=>[e.checked_at,`"${e.url||Se(e.website_id)}"`,e.status,e.response_time_ms||0,`"${e.error_reason||""}"`].join(","))].join("\n"),t=new Blob([a],{type:"text/csv"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=`uptime-logs-${(new Date).toISOString().split("T")[0]}.csv`,s.click(),URL.revokeObjectURL(l)}t(async()=>{await de.fetchWebsites(),await fe(),he=j.on("log",e=>{xe.value&&(ke.value.unshift(e),ke.value.length>500&&(ke.value=ke.value.slice(0,500)))})}),l(()=>{he&&he()}),s([ye,ge,me],()=>{xe.value||fe()},{deep:!0}),s(me,()=>{ge.value=1});const Le=x(()=>xe.value&&ke.value.length?ke.value:ve.value),Ue=x(()=>{const e=[],a=ge.value-2,t=ge.value+2+1;let l;for(let s=1;s<=be.value;s++)(1===s||s===be.value||s>=a&&s<t)&&(l&&(s-l===2?e.push(l+1):s-l!==1&&e.push("...")),e.push(s),l=s);return e}),Re=x(()=>({start:(ge.value-1)*me.value+1,end:Math.min(ge.value*me.value,pe.value)}));return(e,a)=>{const t=w("router-link");return f(),r("div",L,[o("div",U,[a[13]||(a[13]=o("div",null,[o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Logs"),o("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," View and filter uptime check logs ")],-1)),o("div",R,[o("button",{onClick:Ce,class:i(["btn",xe.value?"btn-success":"btn-secondary"])},[o("span",{class:i(["w-2 h-2 rounded-full mr-2",xe.value?"bg-white animate-pulse":"bg-gray-400"])},null,2),d(" "+c(xe.value?"Live":"Paused"),1)],2),o("button",{onClick:Ie,class:"btn-secondary"},[...a[12]||(a[12]=[o("svg",{class:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),d(" Export CSV ",-1)])])])]),o("div",M,[o("div",$,[o("div",null,[a[15]||(a[15]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Website",-1)),v(o("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>ye.value.websiteId=e),class:"select"},[a[14]||(a[14]=o("option",{value:""},"All Websites",-1)),(f(!0),r(g,null,m(b(de).websites,e=>(f(),r("option",{key:e.id,value:e.id},c(e.name||e.url),9,T))),128))],512),[[p,ye.value.websiteId]])]),o("div",null,[a[17]||(a[17]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Status",-1)),v(o("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>ye.value.status=e),class:"select"},[...a[16]||(a[16]=[o("option",{value:""},"All Status",-1),o("option",{value:"up"},"Up",-1),o("option",{value:"down"},"Down",-1)])],512),[[p,ye.value.status]])]),o("div",null,[a[18]||(a[18]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"From",-1)),v(o("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>ye.value.from=e),type:"datetime-local",class:"input"},null,512),[[y,ye.value.from]])]),o("div",null,[a[19]||(a[19]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"To",-1)),v(o("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>ye.value.to=e),type:"datetime-local",class:"input"},null,512),[[y,ye.value.to]])]),o("div",{class:"flex items-end"},[o("button",{onClick:je,class:"btn-secondary w-full"}," Clear Filters ")])])]),xe.value?(f(),r("div",V,[a[20]||(a[20]=o("span",{class:"w-2 h-2 rounded-full bg-success-500 animate-pulse"},null,-1)),d(" Showing live logs. New entries will appear automatically. ("+c(ke.value.length)+" new logs) ",1)])):n("",!0),xe.value?n("",!0):(f(),r("div",B,[o("div",N,[a[21]||(a[21]=o("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Show",-1)),v(o("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>me.value=e),class:"select w-24"},[(f(),r(g,null,m(we,e=>o("option",{key:e,value:e},c(e),9,P)),64))],512),[[p,me.value]]),a[22]||(a[22]=o("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"entries",-1))]),o("div",W," Showing "+c(Re.value.start)+" to "+c(Re.value.end)+" of "+c(pe.value)+" entries ",1)])),ce.value?(f(),r("div",E,[k(S,{size:"lg"})])):Le.value.length?(f(),r("div",D,[o("div",F,[o("table",O,[a[23]||(a[23]=o("thead",null,[o("tr",null,[o("th",null,"Timestamp"),o("th",null,"Website"),o("th",null,"Status"),o("th",null,"Response Time"),o("th",null,"Error")])],-1)),o("tbody",q,[(f(!0),r(g,null,m(Le.value,e=>{return f(),r("tr",{key:e.id||`${e.website_id}-${e.checked_at}`,class:i("down"===e.status?"bg-danger-50/50 dark:bg-danger-900/20":"")},[o("td",z,c((a=e.checked_at,a?new Date(a).toLocaleString():"-")),1),o("td",null,[k(t,{to:`/websites/${e.website_id}`,class:"text-primary-600 hover:text-primary-700 dark:text-primary-400 hover:underline"},{default:h(()=>[d(c(e.url||Se(e.website_id)),1)]),_:2},1032,["to"])]),o("td",null,[o("span",{class:i(["badge","up"===e.status?"badge-success":"badge-danger"])},c(e.status),3)]),o("td",A,c(e.response_time_ms||e.responseTime||0)+" ms ",1),o("td",{class:"text-gray-500 dark:text-gray-400 max-w-xs truncate",title:e.error_reason||e.errorReason},c(e.error_reason||e.errorReason||"-"),9,G)],2);var a}),128))])])]),!xe.value&&be.value>1?(f(),r("div",H,[o("div",J,[o("div",K,[o("button",{onClick:a[5]||(a[5]=e=>_e(ge.value-1)),disabled:1===ge.value,class:"btn-secondary"}," Previous ",8,Q),o("span",X," Page "+c(ge.value)+" of "+c(be.value),1),o("button",{onClick:a[6]||(a[6]=e=>_e(ge.value+1)),disabled:ge.value===be.value,class:"btn-secondary"}," Next ",8,Y)]),o("div",Z,[o("button",{onClick:a[7]||(a[7]=e=>_e(1)),disabled:1===ge.value,class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"First page"},[...a[24]||(a[24]=[o("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})],-1)])],8,ee),o("button",{onClick:a[8]||(a[8]=e=>_e(ge.value-1)),disabled:1===ge.value,class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous page"},[...a[25]||(a[25]=[o("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,ae),(f(!0),r(g,null,m(Ue.value,e=>(f(),r(g,{key:e},["..."===e?(f(),r("span",te,"...")):(f(),r("button",{key:1,onClick:a=>_e(e),class:i(["min-w-[40px] h-10 rounded-lg font-medium transition-colors",ge.value===e?"bg-primary-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"])},c(e),11,le))],64))),128)),o("button",{onClick:a[9]||(a[9]=e=>_e(ge.value+1)),disabled:ge.value===be.value,class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next page"},[...a[26]||(a[26]=[o("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,se),o("button",{onClick:a[10]||(a[10]=e=>_e(be.value)),disabled:ge.value===be.value,class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Last page"},[...a[27]||(a[27]=[o("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})],-1)])],8,re)]),o("div",oe,[a[28]||(a[28]=o("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Go to page:",-1)),o("input",{type:"number",min:1,max:be.value,value:ge.value,onChange:a[11]||(a[11]=e=>_e(parseInt(e.target.value))),class:"input w-20 text-center"},null,40,ne)])])])):n("",!0)])):(f(),u(I,{key:3,title:"No logs found",description:"No logs match your current filters. Try adjusting your search criteria.",icon:"empty"}))])}}};export{ue as default};
